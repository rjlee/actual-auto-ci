name: Compose Docker tag list
description: 'Compose tags for a given API version (patch/minor/major and optional api-stable)'
inputs:
  image-name:
    description: 'Base image name (e.g., ghcr.io/owner/repo)'
    required: true
  ver:
    description: 'API version (patch)'
    required: true
  max-major:
    description: 'Highest major across matrix builds'
    required: true
  include-major:
    description: 'Include api-<major> tag'
    required: false
    default: 'true'
  include-minor:
    description: 'Include api-<minor> tag'
    required: false
    default: 'false'
  include-patch:
    description: 'Include api-<patch> tag'
    required: false
    default: 'false'
  include-stable:
    description: 'Include api-stable for highest major'
    required: false
    default: 'false'
  include-latest:
    description: 'Include latest for highest major'
    required: false
    default: 'true'
outputs:
  list:
    description: 'Newline-delimited tag list'
    value: ${{ steps.t.outputs.list }}
runs:
  using: composite
  steps:
    - name: Build tags
      id: t
      shell: bash
      run: |
        set -euo pipefail
        V='${{ inputs.ver }}'
        MINOR=${V%.*}
        MAJOR=${V%%.*}
        LIST=""
        if [ "${{ inputs['include-patch'] }}" = "true" ]; then
          LIST="${{ inputs['image-name'] }}:api-${V}"
        fi
        if [ "${{ inputs['include-minor'] }}" = "true" ]; then
          LIST="${LIST:+$LIST,}${{ inputs['image-name'] }}:api-${MINOR}"
        fi
        if [ "${{ inputs['include-major'] }}" = "true" ]; then
          LIST="${LIST:+$LIST,}${{ inputs['image-name'] }}:api-${MAJOR}"
        fi
        if [ "${{ inputs['include-stable'] }}" = "true" ] && [ "$MAJOR" = "${{ inputs['max-major'] }}" ]; then
          LIST="$LIST,${{ inputs['image-name'] }}:api-stable"
        fi
        if [ "${{ inputs['include-latest'] }}" = "true" ] && [ "$MAJOR" = "${{ inputs['max-major'] }}" ]; then
          LIST="$LIST,${{ inputs['image-name'] }}:latest"
        fi
        echo "list=$LIST" >> "$GITHUB_OUTPUT"
